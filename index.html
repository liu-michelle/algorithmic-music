<body></body>
<script src="https://unpkg.com/tone"></script>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://algorithmicmusic.online/js/create-spectrum.js"></script>
<script src="https://algorithmicmusic.online/js/create-waveform.js"></script>
<script>
/* global Tone, nn, d3, createWaveform, createSpectrum */
const amen = 'https://algorithmicmusic.online/audios/amen-break.mp3'
const player = new Tone.Player(amen)
player.toDestination()

const timecodes = [
  { offset: 1.8017901897601145, duration: 0.21934837092731851 },
  { offset: 2.0159159804272586, duration: 0.2193483709273183 },
  { offset: 2.2404869316147513, duration: 0.2193483709273183 },
  { offset: 2.4598353025420696, duration: 0.10445160520348473 },
  { offset: 2.55906432748538, duration: 0.12011934598400797 },
  { offset: 2.679183673469388, duration: 0.09922902494331032 },
  { offset: 2.7784126984126982, duration: 0.10445160520348518 },
  { offset: 2.8880868838763574, duration: 0.13056450650435636 },
  { offset: 3.0186513903807137, duration: 0.08878386442296193 },
  { offset: 3.1022126745435017, duration: 0.21412579066714388 }
]

function playPhrase() {
  const numNotes = Math.floor(nn.random() * 5) +1;
  const now = Tone.now();
  for (let i = 0; i < numNotes; i++) {
    const rand = Math.floor(nn.random() * timecodes.length);
    const tc = timecodes[rand];
    const delay = i * nn.random() * 0.5;
    player.start(now + delay, tc.offset, tc.duration);
  }
}

nn.create('label')
  .addTo('body')
  .content('press any key')

const wave = createWaveform()
player.connect(wave)

nn.on('keydown', (e) => {
  playPhrase()
})

window.addEventListener('load', ()=>{
  Tone.start()
    setInterval(() => {
    playPhrase();
  }, 400);
})

</script>